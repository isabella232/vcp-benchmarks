- name: "Setup Dummy-API"
  hosts: vcpbench-varnish*
  tasks:
    - name: "Copy dummy-api binary"
      copy: src="files/dummy-api"
            dest="/usr/local/bin/dummy-api"
            mode=555 owner=root group=root

    - name: "Ensure the dummy-api user is present"
      user: name="dummy-api" comment="Dummy API system user"
            system="yes" state="present"

    - name: "Ensure dummy-api service script is present"
      copy: src="files/dummy-api.service"
            dest="/etc/systemd/system/dummy-api.service"
            mode=444 owner=root group=root
      notify:
        - "Restart dummy-api"

    - name: "Ensure dummy-api is running"
      service: name="dummy-api" state="running" enabled="yes"

  handlers:
    - name: "Restart dummy-api"
      service: name="dummy-api" state="restarted"
